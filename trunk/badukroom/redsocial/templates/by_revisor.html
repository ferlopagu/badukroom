{% extends "base_perfil_home.html" %} 
{% load staticfiles %} 
{% block columna_principal %}

<h1>Revisiones de: {{nick}} [{{rango}}]</h1>

{%block tabla%}
<table class="table">
	<thead>
		<tr>
			<th>Revisor</th>
			<th>Jugador Negro</th>
			<th>Jugador Blanco</th>
			<th>Fecha</th>
			<th>Resultado</th>
			<th>Partida</th>
		</tr>
	</thead>
	<tbody id="nuevos_datos">
		{%block resultados%}
		{% for p in partidas_revisadas %}
			<tr>
				<td><a href="{% url 'redsocial:by_revisor' p.revisor.nickname_kgs %}">{{p.revisor.nickname_kgs}}</a></td>
				<!--  <td><a href="{ url 'redsocial:partidas_jugador' p.jugador_negro.id }">{{p.jugador_negro}}</a></td> -->
				<!--  <td><a href="{ url 'redsocial:partidas_jugador' p.jugador_blanco.id }">{{p.jugador_blanco}}</a></td> -->
				<td>{{p.jugador_negro}} [{{p.rango_negro}}]</td>
				<td>{{p.jugador_blanco}} [{{p.rango_blanco}}]</td> 
				<td>{{p.fecha}}</td>
				<td>{{p.resultado}}</td>
				<td><a href="{% url 'redsocial:ver_partida_revisada' p.id %}">Visualizar</a></td>
			</tr>
		{% endfor %}
		{%endblock resultados%}
	</tbody>
</table>
<div id="next">
	<!--  <li><a id="recargar" href="">Recargar</a></li> -->
	<a class="btn btn-primary" id="recargar" href="">Recargar</a>
</div>
{%endblock tabla%}


{% endblock columna_principal %} 
{% block js2 %}
<script type="text/javascript">
	$(function() {
		$.comentar();
		$.buscador();
		$.contar();
		$.aceptarPeticion();
		$.agregar();
		$.eliminar();
		$.responder();
		$.recargar();
		
		$('#recargar').on(
				'click',
				function(event) {
					event.preventDefault();
					
					//Almacenamos el nick del revisor
					alert(location.href);
					var dir_ip = location.href;
					var array_dir = dir_ip.split("/");
					alert(array_dir);
					var nickname=array_dir[array_dir.length-2]; //el -2 es por la url al finalizar con una barra al final
					alert(nickname);
					
					console.log("Entramos en load items");
					if (hasNextPage === false) {
						return false //ya no haria falta ya que al comprobar si son menos de diez se eliminara el boton
					}
					pageNum = pageNum + 1;
					$.ajax({
						url : "/redsocial/by_revisor/"+nickname+"/",
						data : {
							page_number : pageNum
						},
						dataType : 'json', //add esto cuando vayamos a recivir del servidor un json
						success : function(data) {
							if(data.length < 10){
								$('#next').html("<div class='alert alert-info' role='alert'>Ya no hay m√°s partidas que mostrar</div>");
							}
							hasNextPage = true;
							html = "";
							console.log("Valor que tenia html: " + html);
							for (i = 0; i < data.length; i++){
								html+="<tr><td><a href='/redsocial/by_revisor/"+data[i].revisor_nickname+"'>"+data[i].revisor_nickname +" ["+data[i].revisor_rango+"]</a></td>" //COMPLETAR EL JSON EN LA VISTA
								+"<td>"+data[i].jugador_negro_nombre+" ["+data[i].rango_negro+"]</td>"
								+"<td>"+data[i].jugador_blanco_nombre+" ["+data[i].rango_blanco+"]</td>"
								+"<td>"+fecha_def+"</td>"
								+"<td>"+data[i].resultado+"</td>"
								+"<td><a href='/redsocial/ver_revision/"+data[i].partida_id+"''>Visualizar</a></td></tr>";
							}
							$("#nuevos_datos").append(html);
						},
						error : function(data) {
							hasNextPage = false;
						}
					});
				});
	});
</script>

{% endblock js2 %}
