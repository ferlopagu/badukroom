{% extends "base_perfil_home.html" %} 
{% load staticfiles %} 
{% block columna_principal %}

<ul class="nav nav-tabs" role="tablist">
	<li role="presentation" class="active"><a href="#recientes"
		aria-controls="recientes" role="tab" data-toggle="tab">Recientes</a></li>
	<li role="presentation"><a href="#jugador" aria-controls="jugador"
		role="tab" data-toggle="tab">Jugador</a></li>
	<li role="presentation"><a href="#avanzada"
		aria-controls="avanzada" role="tab" data-toggle="tab">Busqueda
			avanzada</a></li>
</ul>



<ul class="nav nav-pills" role="tablist" style="float:right">
	<li><a href="#">Subir partida</a></li>
</ul>
<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="recientes">
		<table class="table">
			<thead>
				<tr>
					<th>Jugador Negro</th>
					<th>Jugador Blanco</th>
					<th>Fecha</th>
					<th>Resultado</th>
					<th>Partida</th>
				</tr>
			</thead>
			<tbody id="nuevos_datos">
				{% for p in lista_partidas %}
					<tr>
						<td><a href="{% url 'redsocial:partidas_jugador' p.jugador_negro.id %}">{{p.jugador_negro}}</a></td>
						<td><a href="{% url 'redsocial:partidas_jugador' p.jugador_blanco.id %}">{{p.jugador_blanco}}</a></td>
						<td>{{p.fecha}}</td>
						<td>{{p.resultado}}</td>
						<td><a href="{% url 'redsocial:ver_partida' p.id %}">Visualizar</a></td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		
		<div id="next">
			<a class="btn btn-primary" id="recargar" href="">Recargar</a>
		</div>
	</div>

	<div role="tabpanel" class="tab-pane" id="jugador">
		<!--  
		<div id="css_jugadores" style="display: inline-table">
		{ for key, values in dic_jugadores.items }
			
			<ul class="list-group" >
			<li class="list-group-item list-group-item-success">{key}</li>
			{ for jugador in values }
				
				
  				<li class="list-group-item" ><a href="{ url 'redsocial:partidas_jugador' jugador.id }">{jugador.nombre}</a></li>


			{ endfor }
			</ul>
		{endfor}
		</div>
		-->
		{% for key, values in dic_jugadores.items %}
			<div class="panel panel-info" style="display: inline-table">
				<div class='panel-heading' id="{{key}}">
					<a href="#{{key}}">{{key}}</a>
				</div>
				{% for jugador in values %}
				<div class="panel-body">
					<a href="{% url 'redsocial:partidas_jugador' jugador.id %}">{{jugador.nombre}}</a>
				</div>
				{% endfor %}
			</div>
		{%endfor%}
	</div>

	<div role="tabpanel" class="tab-pane" id="avanzada">
		<h5>Estamos en BUSQUEDA AVANZADA</h5>
		Fecha: <input type="date" step="1" min="1714-01-01" max="2020-12-31" value="2015-01-01">
	</div>
</div>

{% endblock columna_principal %} 
{% block js2 %}
<script type="text/javascript">
	$(function() {
		$.comentar();
		$.buscador();
		$.contar();
		$.aceptarPeticion();
		$.agregar();
		$.eliminar();
		$.responder();
		$.recargar();
		
		$('#recargar').on(
				'click',
				function(event) {
					//alert("entramos en recargar");
					event.preventDefault();
					console.log("Entramos en load items");
					// If the next page doesn't exist, just quit now 
					if (hasNextPage === false) {
						//alert("hasNextPage es false");
						return false //ya no haria falta ya que al comprobar si son menos de diez se eliminara el boton
					}
					// Update the page number
					pageNum = pageNum + 1;
					// Configure the url we're about to hit
					$.ajax({
						url : "{% url 'redsocial:partidas_ajax' %}",
						data : {
							page_number : pageNum
						},
						dataType : 'json', //add esto cuando vayamos a recivir del servidor un json
						success : function(data) {
							//alert(data.length);
							if(data.length < 10){
								//alert("No hay mas páginas");
								$('#next').html("<div class='alert alert-info' role='alert'>Ya no hay más partidas que mostrar</div>");
							}
							
							//alert(JSON.stringify(data.fields));
							//No se ejecuta lo de dentro y si el complete
							//alert("entramos en success");
							// Update global next page variable
							hasNextPage = true;//.hasNext;
							// Loop through all items
							html = "";
							console.log("Valor que tenia html: " + html);
							//alert("Imprimimos json fields");
							//alert(JSON.stringify(data.fields));
							for (i = 0; i < data.length; i++){
								
								
								//TRATAMIENTO DE LA FECHA
								//console.log(data[i].fields.fecha);
								fecha =  new Date(data[i].fields.fecha);
								//console.log("Fecha: "+fecha.toUTCString());
								var options = {weekday: "long", year: "numeric", month: "long", day: "numeric"};
								fecha=fecha.toLocaleDateString("es-ES", options);
								fecha_string=fecha.split(",");
								fecha_def=fecha_string[1];
								//console.log(fecha_def);
								//FIN TRATAMIENTO DEL FORMATO DE LA FECHA
								
								
								/*
								html += "<tr>" + "<th>"
								+ "<a href='redsocial/jugadores/"+ data[i].fields.jugador_negro[1] +"/'></a>"
										+ data[i].fields.jugador_negro[0]+ "</th>"
										+ "<th>" + data[i].fields.jugador_blanco[0]
										+ "</th>" + "<th>" + data[i].fields.fecha
										+ "</th>" + "<th>" + data[i].fields.resultado
										+ "</th>" + "<th>"
										+ data[i].fields.path+ "</th>"
										+ "</tr>"; */
								html+="<tr><td><a href='/redsocial/jugadores/"+data[i].fields.jugador_negro[1]+"'>"+data[i].fields.jugador_negro[0]+"</a></td>"
								+"<td><a href='/redsocial/jugadores/"+data[i].fields.jugador_blanco[1]+"'>"+data[i].fields.jugador_blanco[0]+"</a></td>"
								+"<td>"+fecha_def+"</td>"
								+"<td>"+data[i].fields.resultado+"</td>"
								+"<td><a href='/redsocial/ver_partida/"+data[i].pk+"''>Visualizar</a></td>";
								//+"<td>"+data[i].fields.path+"</td>";
								
								

								/*
								$("#newItems").before(
								// Do something with your json object response
									//console.log(i)
									//console.log(data[i])
									
								);*/
							}
							$("#nuevos_datos").append(html);
						},
						error : function(data) {
							// When I get a 400 back, fail safely
							hasNextPage = false;
						},
				        complete: function(data, textStatus){
				            // Turn the scroll monitor back on
				            //alert("Completado");
						}
					});
					//alert("Realizado con exito");
				});
	});
</script>

{% endblock js2 %}
